// –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π —Å Firebase
class OnlineSync {
    constructor() {
        this.isOnline = false;
        this.init();
    }

    async init() {
        // –ñ–¥–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Firebase
        if (!firebaseConfig.initialized) {
            await firebaseConfig.initialize();
        }
        this.isOnline = firebaseConfig.isOnline();
        this.setupSync();
    }

    setupSync() {
        // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
        // (–¥–æ–±–∞–≤–∏–º –ø–æ–∑–∂–µ)
        console.log('‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≥–æ—Ç–æ–≤–∞');
    }

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –≤ Firebase
    async saveCharacter(characterData) {
        if (!this.isOnline) {
            console.log('üì¥ –û—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º - —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ');
            return false;
        }

        try {
            const db = firebaseConfig.getDatabase();
            await db.collection('characters').doc(characterData.id).set(characterData);
            console.log('‚úÖ –ü–µ—Ä—Å–æ–Ω–∞–∂ —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –æ–±–ª–∞–∫–æ:', characterData.name);
            return true;
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
            return false;
        }
    }

    // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    async loadUserCharacters(userId) {
        if (!this.isOnline) {
            console.log('üì¥ –û—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º - –∑–∞–≥—Ä—É–∂–∞–µ–º –ª–æ–∫–∞–ª—å–Ω–æ');
            return [];
        }

        try {
            const db = firebaseConfig.getDatabase();
            const snapshot = await db.collection('characters')
                .where('userId', '==', userId)
                .get();
            
            const characters = [];
            snapshot.forEach(doc => {
                characters.push(doc.data());
            });
            
            console.log('‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π:', characters.length);
            return characters;
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
            return [];
        }
    }
}

// –°–æ–∑–¥–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä
const onlineSync = new OnlineSync();
